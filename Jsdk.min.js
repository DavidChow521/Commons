(function(global,factory){var defaults={vsrsion:"1.3.5",debug:true,now:new Date()},methods=["backCardNo","jsonDate","moneyRoundOff","chinese","chineseAmt","trimAll","isNullOrEmpty","isNullOrWhiteSpace","isEmail","isZipCode","isChinese","isEnglish","isExists","distinct","format","newGuid","ajax","getById","createScript","createLink","getCookie","basic","request","submit","setCache","getCache","removeCache","clearCache","downloadCanvas"];factory.$=function(){return new factory.$.fn.init()};factory.$.fn=factory.prototype={init:function(){var self=new factory();methods.forEach(function(f,e){defaults[f]=function(){return fn(this,f,arguments)}});function fn(that,f,args){return eval("self."+f).apply(that,args)}if(defaults.debug){console.log(defaults);console.log("%c Jsdk初始化成功！","color:#5EB0FA")}return defaults}};global.Jsdk=global.Jsdk||factory.$();if(typeof define==="function"&&define.amd){define(["Jsdk"],factory)}else{if(typeof exports==="object"){require("Jsdk")}}}(this,function(){var that=this;this.backCardNo=function(cardno,replacing,index){var i=4,r=" ";if(!that.isNullOrEmpty(index)){if($.isNumeric(index)){i=index}}if(typeof(replacing)!==undefined&&!that.isNullOrEmpty(replacing)){r=replacing}var regex=eval("/(\\d{"+i+"})(?=\\d)/g");return cardno.replace(/[\s]/g,"").replace(regex,"$1"+r)};this.jsonDate=function(date,replacing,showtime){var r="-",s=true;if(typeof(replacing)!==undefined&&String(replacing).trim()!==""){r=replacing}if(typeof(showtime)!==undefined&&typeof(showtime)==="boolean"){s=showtime}function f(e){return e<10?"0"+e.toString():e}date=eval("new "+date.replace("/","","g").replace("/","","g"));var year=date.getFullYear(),month=f(date.getMonth()+1),dates=f(date.getDate()),hours=f(date.getHours()),minutes=f(date.getMinutes()),Seconds=f(date.getSeconds());if(s){return year+r+month+r+dates+" "+hours+":"+minutes+":"+Seconds}return year+r+month+r+dates};this.moneyRoundOff=function(money,index,currency){var i=2;if(!that.isNullOrEmpty(index)){if($.isNumeric(index)){i=index}}if($.isNumeric(money)){if(!that.isNullOrEmpty(currency)){return currency+(parseFloat(money)).toFixed(i)}return(parseFloat(money)).toFixed(i)}return null};this.chinese=function(arabnum){if(!/^\d*(\.\d*)?$/.test(arabnum)){alert("Number is wrong!");return"Number is wrong!"}var A=new Array("零","壹","贰","叁","肆","伍","陆","柒","捌","玖");var B=new Array("","拾","佰","仟","万","億","点","");var a=(""+arabnum).replace(/(^0*)/g,"").split("."),k=0,re="";for(var i=a[0].length-1;i>=0;i--){switch(k){case 0:re=B[7]+re;break;case 4:if(!new RegExp("0{4}\\d{"+(a[0].length-i-1)+"}$").test(a[0])){re=B[4]+re}break;case 8:re=B[5]+re;B[7]=B[5];k=0;break}if(k%4==2&&a[0].charAt(i+2)!=0&&a[0].charAt(i+1)==0){re=A[0]+re}if(a[0].charAt(i)!=0){re=A[a[0].charAt(i)]+B[k%4]+re}k++}if(a.length>1){re+=B[6];for(var i=0;i<a[1].length;i++){re+=A[a[1].charAt(i)]}}return re};this.chineseAmt=function(arabnum){if(!/^\d*(\.\d*)?$/.test(arabnum)){return""}arabnum=parseFloat(arabnum).toFixed(2);var cnNum=that.chinese(arabnum);var a=cnNum.split("点");var ret="";ret+=(a[0]+"圆");if(a.length>1){for(var i=0;i<a[1].length;i++){ret+=a[1][i];if(i==0){ret+="角"}else{if(i==1){ret+="分"}}}}else{ret+="整"}return ret};this.trimAll=function(value,center){var c=true,value=String(value).trim();if(!that.isNullOrEmpty(center)){c=center}if(c){return value.replace(/[\s]/g,"")}return value};this.isNullOrEmpty=function(value){return value===undefined||value===null||value.trim()===""||typeof(value)===undefined};this.isNullOrWhiteSpace=function(value){return that.isNullOrEmpty(value)||String(value).trim()===""};this.isEmail=function(value){value=that.isNullOrEmpty(value)?"":String(value);return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(value)};this.isZipCode=function(value){value=that.isNullOrEmpty(value)?"":String(value);return/^[\d]{6}$/.test(value)};this.isChinese=function(value){value=that.isNullOrEmpty(value)?"":String(value);return/^[\u0391-\uFFE5]+$/i.test(value)};this.isEnglish=function(value){value=that.isNullOrEmpty(value)?"":String(value);return/^[A-Za-z]+$/i.test(value)};this.isExists=function(s){var hash={};for(var i in s){if(hash[s[i]]){return true}hash[s[i]]=true}return false};this.isIPv4=function(ipv4){var reg=/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;if(reg.exec(ipv4)==null){if(RegExp.$1<0||RegExp.$1>255){return false}if(RegExp.$2<0||RegExp.$2>255){return false}if(RegExp.$3<0||RegExp.$3>255){return false}if(RegExp.$4<0||RegExp.$4>255){return false}}else{return false}return true};this.distinct=function(value){var r=[],hash={};for(var i=0,v;(v=value[i])!=null;i++){if(!hash[v]){r.push(v);hash[v]=true}}return r};this.format=function(){var str=that.isNullOrEmpty(arguments[0])?"":String(arguments[0]);if($.isArray(arguments[1])){for(var i=0;i<arguments[1].length;i++){var value=arguments[1][i]?arguments[1][i]:"";str=str.replace(new RegExp("\\{"+i+"}","gm"),value)}}else{var data=$(arguments).slice(1,arguments.length);for(var i=0;i<data.length;i++){str=str.replace(new RegExp("\\{"+i+"}","gm"),data[i])}}return str};this.newGuid=function(len){len=len||32;var guid="";for(var i=1;i<=len;i++){var n=Math.floor(Math.random()*16).toString(16);guid+=n}return guid};this.basic=function(){var _matched,_browser;var _userAgentMatch=function(userAgent){userAgent=userAgent.toLowerCase();var match=/(chrome)[ \/]([\w.]+)/.exec(userAgent)||/(webkit)[ \/]([\w.]+)/.exec(userAgent)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(userAgent)||/(msie) ([\w.]+)/.exec(userAgent)||userAgent.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(userAgent)||[];return{browser:match[1]||"",version:match[2]||"0"}};_matched=_userAgentMatch(window.navigator.userAgent);_browser={};if(_matched.browser){_browser[_matched.browser]=true;_browser.version=_matched.version}if(_browser.chrome){_browser.webkit=true}else{if(_browser.webkit){_browser.safari=true}}return _browser};this.request=function(key){var regexp=new RegExp("(^|&)"+key+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(regexp);if(r!=null){return unescape(r[2])}return null};this.submit=function(action,object){var form=document.forms["_JSDK.SUBMIT_"];if(form){form.innerHTML=""}else{form=document.createElement("form");form.name="_JSDK.SUBMIT_";form.style="display:none";form.method="post";form.target="_blank"}form.id=that.format("_SUBMIT_{0}",new Date().getTime());form.action=action;$.each(object,function(k,v){var input=document.createElement("input");input.name=k;input.value=v;input.type="hidden";form.appendChild(input)});document.body.appendChild(form);form.submit()};this.setCache=function(key,value){localStorage.setItem(key,value)};this.getCache=function(key){return localStorage.getItem(key)};this.removeCache=function(key){localStorage.removeItem(key)};this.clearCache=function(){localStorage.clear()};this.downloadCanvas=function(canvas,filename,image){var img="image/png",name=that.newGuid(),a=document.createElement("a");if(!that.isNullOrEmpty(filename)){name=filename}a.download=name;if(!that.isNullOrEmpty(image)){img=image}a.href=canvas.toDataURL(img);document.body.appendChild(a);a.click();document.body.removeChild(a)};this.ajax=function(options){options=options||{};options.async=options.async||true;options.type=(options.type||"POST").toUpperCase();options.dataType=options.dataType||"json";options.contenttype=options.contenttype||"application/json; charset=utf8";options.data=options.data||null;var params=null;if(options.data!=undefined&&options.data!=null&&options.data!=""){params=formatParams(options.data)}if(window.XMLHttpRequest){var xhr=new XMLHttpRequest()}else{var xhr=new ActiveXObject("Microsoft.XMLHTTP")}if(options.type=="GET"){xhr.open("GET",options.url+"?"+params,options.async);xhr.send(null)}else{if(options.type=="POST"){xhr.open("POST",options.url,options.async);xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded");xhr.send(params)}}xhr.onreadystatechange=function(){if(xhr.readyState==4){var status=xhr.status;if(status>=200&&status<300){options.success&&options.success(parseJSON(xhr.response),xhr)}else{options.error&&options.error(status)}}};function formatParams(data){var arr=[];for(var name in data){arr.push(encodeURIComponent(name)+"="+encodeURIComponent(data[name]))}arr.push(("v="+Math.random()).replace(".",""));return arr.join("&")}function parseJSON(data){if(typeof data!=="string"||!data){return null}data=String(data).trim();if(window.JSON&&window.JSON.parse){return window.JSON.parse(data)}if(/^[\],:{}\s]*$/.test(data.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){return(new Function("return "+data))()}console.error("Invalid Jsdk: "+data)}};this.getById=function(id){return document.getElementById(id)};this.createScript=function(url){var script=document.createElement("script");script.type="text/javascript";script.src=url;return script};this.createLink=function(url){var link=document.createElement("link");link.rel="stylesheet";link.type="text/css";link.href=url;return link};this.getCookie=function(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)"),ret=null;if(arr=document.cookie.match(reg)){ret=decodeURIComponent(arr[2])}return ret}}));this.Jsdk.loader=function(){function b(f){var e=document.createElement("script");e.type="text/javascript";e.src=f;return e}function d(e){var f=document.createElement("link");f.rel="stylesheet";f.type="text/css";f.href=e;return f}function c(f){var e=document.getElementsByTagName("head")[0];e.appendChild(f)}function a(){this.loadAsync=function(h){if(h&&h instanceof Array){if(h.length){var g=undefined;var f=undefined;for(var e=0;e<h.length;e++){g=h[e];if(g.type=="link"){f=d(g)}else{if(g.type=="script"){f=b(g)}}c(f)}}}};this.loadUrl=function(f,h){if(!f){return}var g;if(f.type=="link"){g=d(f.src)}else{if(f.type=="script"){g=b(f.src)}}var e=false;g.onload=function(){if(!e){e=true;g.onload=null;if(h){if(h!=null&&typeof h=="function"){h.call(g)}}}};c(g)};this.load=function(h,j){if(h&&h instanceof Array){var g=undefined,f=undefined;elArr=[];if(h.length>0){for(var e=0;e<h.length;e++){g=h[e];if(g.type=="link"){f=d(g);elArr.push(f)}else{if(g.type=="script"){f=b(g);elArr.push(f)}}}for(var e=0;e<elArr.length;e++){g=elArr[e];g.onload=(function(l){var m=this;var k=false;if(!k){k=true;m.onload=null;if(l+1<elArr.length){c(g)}else{j.call(g)}}})(e)}}}}}return a}();this.Jsdk.Lambda=(function(){var Lambda=function(){this.getData=arguments[0]};Lambda.from=function(){var newArray=new Array();for(var i=0;i<arguments[0].length;i++){newArray[i]=arguments[0][i]}return new Lambda(newArray)};Lambda.prototype={select:function(predicate){var newArray=new Array();for(var i=0;i<this.getData.length;i++){var item=this.getData[i];item=predicate(item,i);newArray.push(item)}return new Lambda(newArray)},where:function(predicate){var newArray=new Array();for(var i=0;i<this.getData.length;i++){var item=this.getData[i];var success=predicate(item,i);if(success){newArray.push(item)}}return new Lambda(newArray)},sum:function(predicate){var result=0;for(var i=0;i<this.getData.length;i++){var item=this.getData[i];if(predicate!=null){item=predicate(item)}result+=item;result=Math.round(result*10000)/10000}return result},toArray:function(){return this.getData},foreach:function(predicate){for(var i=0;i<this.getData.length;i++){var item=this.getData[i];predicate(item,i)}},contains:function(inputobj){if(inputobj==null){return false}var predicate=function(item){return item===inputobj};if(inputobj instanceof Function){predicate=inputobj}for(var i=0;i<this.getData.length;i++){var item=this.getData[i];if(predicate(item)){return true}}return false},concat:function(array){var inputItemLambda=new Lambda(array);var newArray=new Array();this.Foreach(function(item){newArray.push(item)});inputItemLambda.Foreach(function(item){newArray.push(item)});return new Lambda(newArray)},orderBy:function(sortfunc){var result=new Lambda(this.getData);QuickSort(result.getData,"<",sortfunc);return result},orderByDesc:function(sortfunc){var result=new Lambda(this.getData);QuickSort(result.getData,">",sortfunc);return result},skip:function(count){if(typeof count!="number"){throw"count必须是数字"}var skipCount=parseInt(count,10);var newArray=new Array();for(var i=count;i<this.getData.length;i++){newArray.push(this.getData[i])}return new Lambda(newArray)},take:function(count){if(typeof count!="number"){throw"count必须是数字"}var skipCount=parseInt(count,10);var newArray=new Array();var length=count>this.getData.length?this.getData.length:count;for(var i=0;i<count;i++){newArray.push(this.getData[i])}return new Lambda(newArray)},firstOrDefault:function(predicate){if(predicate==null){return this.getData[0]}for(var i=0;i<this.getData.length;i++){var item=this.getData[i];var success=predicate(item,i);if(success){return item}}},count:function(){return this.getData.length},indexOf:function(predicate){for(var i=0;i<this.getData.length;i++){var item=this.getData[i];if(typeof(predicate)=="function"){if(predicate(item)){return i}}else{if(item==predicate){return i}}}},join:function(splitString){var result="";if(this.getData.length<=0){return result}for(var i=0;i<this.getData.length;i++){result+=this.getData[i];if(i+1!=this.getData.length){result+=splitString}}return result}};function QuickSort(data,operating,func){if(func==null){func=function(item){return item}}var _innerSort=function(data,left,right){var baseNumber=func(data[left]);while(left<right){for(;left<right;right--){if(eval(func(data[right])+operating+baseNumber)){data[left]=data[right];break}}for(;left<right;left++){if(eval(func(data[left])+(operating==">"?"<":">")+baseNumber)){data[right]=data[left];break}}}data[left]=baseNumber;return left};var _sort=function(data,left,right){if(left<right){var middle=_innerSort(data,left,right);_sort(data,left,middle);_sort(data,middle+1,right)}};_sort(data,0,data.length-1)}return Lambda})();String.prototype.Equals=function(a){return this===a};String.prototype.format=function(){that.format.apply(this,arguments)};String.prototype.getBytes=function(){return this.replace(/[^\x00-\xff]/g,"**").length};Array.prototype.contains=function(b){var a=this.length;while(a--){if(this[a]===b){return true}}return false};Date.prototype.ToString=function(c){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};if(/(y+)/i.test(c)){c=c.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}for(var a in b){if(new RegExp("("+a+")").test(c)){c=c.replace(RegExp.$1,RegExp.$1.length==1?b[a]:("00"+b[a]).substr((""+b[a]).length))}}return c};Date.prototype.Equals=function(a){return Date.parse(this)==Date.parse(a)};Date.prototype.addYears=function(a){this.setFullYear(this.getFullYear()+a);return this};Date.prototype.addMonths=function(a){this.setMonth(this.getMonth()+a);return this};Date.prototype.addDays=function(a){this.setDate(this.getDate()+a);return this};Date.prototype.addHours=function(a){this.setHours(this.getHours()+a);return this};Date.prototype.addMinutes=function(a){this.setMinutes(this.getMinutes()+a);return this};Date.prototype.getLastDay=function(){return new Date(new Date(this.getYear(),this.getMonth()+1,1).getTime()-1000*60*60*24).getDate()};Date.prototype.getWeekFirstDay=function(){return new Date(new Date(this.getFullYear(),this.getMonth(),this.getDate()-this.getDay())).getDate()};Date.prototype.getWeekFirstDate=function(){return new Date(new Date(this.getFullYear(),this.getMonth(),this.getDate()-this.getDay()))};